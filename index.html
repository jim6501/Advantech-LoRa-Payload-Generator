<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advantech LoRaWAN Payload Formatter v0.7</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <div class="sidebar d-flex flex-column">
        <div class="brand-section p-4 pb-3 border-bottom border-secondary mb-3"
            style="border-color: #30363d !important;">
            <div class="d-flex align-items-center mb-1">
                <div class="me-3 d-flex align-items-center justify-content-center"
                    style="width: 40px; height: 40px; background: rgba(13, 110, 253, 0.1); border-radius: 8px;">
                    <i class="fa-solid fa-satellite-dish" style="color: #0d6efd; font-size: 1.2rem;"></i>
                </div>
                <div>
                    <div class="text-uppercase fw-bold"
                        style="font-size: 0.65rem; color: #6c757d; letter-spacing: 1px;">Advantech LoRaWAN</div>
                    <div class="fw-bold text-white lh-1 mt-1" style="font-size: 1.1rem; letter-spacing: 0.5px;">Payload
                        Formatter</div>
                </div>
            </div>
            <div class="d-flex justify-content-end mt-2">
                <span class="badge bg-dark border border-secondary text-secondary rounded-pill"
                    style="font-size: 0.6em; padding: 0.3em 0.8em;">v0.71</span>
            </div>
        </div>
        <div class="nav-item active" onclick="switchTab('uplink')" id="nav-uplink">
            <i class="fa-solid fa-arrow-up"></i> Uplink Parser
        </div>
        <div class="nav-item" onclick="switchTab('downlink')" id="nav-downlink">
            <i class="fa-solid fa-paper-plane"></i> Downlink Analysis
        </div>
        <div class="nav-item" onclick="switchTab('mac')" id="nav-mac">
            <i class="fa-solid fa-network-wired"></i> MAC Analysis
        </div>
    </div>

    <div class="main-content">

        <!-- Uplink Parser -->
        <div id="view-uplink">
            <h3 class="mb-4">Uplink Payload Parser</h3>
            <div class="row">
                <div class="col-lg-5">
                    <div class="custom-card mb-4">
                        <div class="card-header">Input</div>
                        <div class="card-body">
                            <label class="text-secondary mb-2">Hex String</label>
                            <textarea class="form-control" id="upHexInput" rows="6" placeholder="811C40..."></textarea>
                            <div class="d-flex gap-2 mt-3">
                                <button class="btn btn-primary flex-grow-1" onclick="runParser()">Parse</button>
                                <button class="btn btn-outline-secondary" onclick="pasteText('upHexInput')"
                                    title="Paste from Clipboard"><i class="fa-regular fa-paste"></i></button>
                                <button class="btn btn-outline-secondary" onclick="clearParser()">Clear</button>
                            </div>
                            <button class="btn btn-outline-secondary w-100 mt-2" onclick="loadUpExample()">Load
                                Example</button>
                        </div>
                    </div>
                </div>
                <div class="col-lg-7">
                    <div class="custom-card h-100">
                        <div class="card-header">
                            Output Result
                            <button class="btn btn-sm btn-outline-secondary"
                                onclick="copyText('upOutput')">Copy</button>
                        </div>
                        <div class="card-body p-0">
                            <pre id="upOutput"
                                class="h-100 border-0 rounded-0 m-0 p-3 text-light font-monospace">Enter Hex string and click Parse...</pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Downlink Generator -->
        <div id="view-downlink" style="display: none;">
            <h3 class="mb-4">Downlink Analysis</h3>
            <div class="row">
                <div class="col-lg-5">
                    <div class="custom-card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>Configuration</span>
                            <!-- Mode Toggle -->
                            <div class="btn-group btn-group-sm" role="group">
                                <input type="radio" class="btn-check" name="dlMode" id="modeGen" autocomplete="off"
                                    checked onchange="toggleDlMode()">
                                <label class="btn btn-outline-primary" for="modeGen">Generator</label>

                                <input type="radio" class="btn-check" name="dlMode" id="modeDec" autocomplete="off"
                                    onchange="toggleDlMode()">
                                <label class="btn btn-outline-primary" for="modeDec">Decoder</label>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Generator View -->
                            <div id="dl-generator-view">
                                <div class="mb-3">
                                    <label class="text-secondary mb-2">1. Category</label>
                                    <select class="form-select" id="genType">
                                        <option value="0x5" selected>Sensor (Temp/Accel) [0x5]</option>
                                        <option value="0x6">Device (System/RTC) [0x6]</option>
                                        <option value="0x8">RS-485 Register [0x8]</option>
                                        <option value="0x7">RS-485 Coil [0x7]</option>
                                        <option value="0x0">DI (Digital Input) [0x0]</option>
                                        <option value="0x1">DO (Digital Output) [0x1]</option>
                                        <option value="0x3">AI (Analog Input) [0x3]</option>
                                    </select>
                                </div>

                                <!-- Sub-Type Selectors -->
                                <div class="mb-3" id="sensorRangeGroup">
                                    <label class="text-secondary mb-2">Sensor Range</label>
                                    <select class="form-select" id="sensorRange">
                                        <option value="0">Temperature / Humidity (0x0-0x3)</option>
                                        <option value="4">Accelerometer / Vibration (0x4-0x5)</option>
                                    </select>
                                </div>

                                <!-- RS-485 Specifics -->
                                <div class="row g-2 mb-3" id="portGroup" style="display:none;">
                                    <div class="col-6">
                                        <label class="text-secondary mb-2">COM Port</label>
                                        <select class="form-select" id="genPort">
                                            <option value="0">Port 1</option>
                                            <option value="1">Port 2</option>
                                        </select>
                                    </div>
                                    <div class="col-6">
                                        <label class="text-secondary mb-2">Channel/Rule</label>
                                        <input type="number" class="form-control" id="genCh485" value="0" min="0"
                                            max="127">
                                    </div>
                                </div>

                                <!-- Standard Channel -->
                                <div class="mb-3" id="channelGroup">
                                    <label class="text-secondary mb-2">Channel</label>
                                    <input type="number" class="form-control" id="genCh" value="0" min="0" max="15">
                                    <div class="form-text small" id="chHint"></div>
                                </div>

                                <!-- Axis Selection (Accel) -->
                                <div class="mb-3" id="axisGroup" style="display:none;">
                                    <label class="text-secondary mb-2">Target Axes (Generates Mask)</label>
                                    <div class="d-flex gap-3">
                                        <div class="form-check"><input class="form-check-input" type="checkbox"
                                                id="axisX" checked><label class="form-check-label text-light">X</label>
                                        </div>
                                        <div class="form-check"><input class="form-check-input" type="checkbox"
                                                id="axisY" checked><label class="form-check-label text-light">Y</label>
                                        </div>
                                        <div class="form-check"><input class="form-check-input" type="checkbox"
                                                id="axisZ" checked><label class="form-check-label text-light">Z</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="text-secondary mb-2">2. Command</label>
                                    <select class="form-select" id="genCmd"></select>
                                </div>

                                <div id="genParamArea" class="mb-4"></div>

                                <div class="border-top border-secondary pt-3 mt-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <label class="text-secondary m-0">Sequence No.</label>
                                        <input type="number" class="form-control form-control-sm w-25" id="genSeq"
                                            value="0">
                                    </div>
                                </div>

                                <button class="btn btn-primary w-100 mt-2" onclick="runGenerator()">Generate
                                    Hex</button>
                            </div>

                            <!-- Decoder View -->
                            <div id="dl-decoder-view" style="display: none;">
                                <div class="mb-3">
                                    <label class="text-secondary mb-2">Downlink Hex String</label>
                                    <textarea class="form-control font-monospace" id="decHexInput" rows="5"
                                        placeholder="Paste Hex here (e.g. 800005...)"></textarea>
                                </div>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-success flex-grow-1" onclick="runDecoder()">Decode</button>
                                    <button class="btn btn-outline-secondary" onclick="pasteText('decHexInput')"
                                        title="Paste from Clipboard"><i class="fa-regular fa-paste"></i></button>
                                    <button class="btn btn-outline-secondary" onclick="clearDecoder()">Clear</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-7">
                    <div class="custom-card h-100">
                        <div class="card-header">
                            Output Result
                            <!-- Copy moved to below -->
                        </div>
                        <div class="card-body p-0">
                            <!-- Generator Output -->
                            <div id="dl-gen-output-area" class="p-4">
                                <label class="text-secondary mb-2">Protocol Structure</label>
                                <div id="genStructure" class="mb-3">
                                    <span class="text-muted small">Select parameters and click Generate...</span>
                                </div>

                                <label class="text-secondary mb-2">Generated Hex String</label>
                                <div class="d-flex gap-2 mb-3">
                                    <div class="gen-output flex-grow-1 mb-0" id="genOutput">Select commands and click
                                        Generate</div>
                                    <button class="btn btn-outline-secondary" onclick="copyText('genOutput')"
                                        title="Copy to Clipboard">
                                        <i class="fa-regular fa-copy"></i>
                                    </button>
                                </div>

                                <div class="border-top border-secondary pt-3 text-start">
                                    <label class="text-secondary small mb-2">Breakdown:</label>
                                    <div class="text-secondary small font-monospace" id="genBreakdown"></div>
                                </div>
                            </div>

                            <!-- Decoder Output -->
                            <div id="dl-dec-output-area" style="display: none;" class="h-100">
                                <div id="decResult" class="text-light h-100 p-3">
                                    <pre
                                        class="h-100 border-0 rounded-0 m-0 p-3 text-light font-monospace">Enter Hex string and click Decode...</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MAC Analysis View -->
        <div id="view-mac" style="display: none;">
            <h3 class="mb-4">MAC Command Analysis</h3>
            <div class="row">
                <div class="col-lg-5">
                    <div class="custom-card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>Configuration</span>
                            <div class="btn-group btn-group-sm" role="group">
                                <input type="radio" class="btn-check" name="macMode" id="macModeGen" autocomplete="off"
                                    checked onchange="toggleMacMode()">
                                <label class="btn btn-outline-primary" for="macModeGen">Generator</label>
                                <input type="radio" class="btn-check" name="macMode" id="macModeDec" autocomplete="off"
                                    onchange="toggleMacMode()">
                                <label class="btn btn-outline-primary" for="macModeDec">Decoder</label>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Generator Inputs -->
                            <div id="mac-gen-view">
                                <div class="mb-3">
                                    <label class="text-secondary mb-2">1. Direction</label>
                                    <select class="form-select" id="macGenDir" onchange="updateMacCommands()">
                                        <option value="down">Downlink (Network Server -> Device)</option>
                                        <option value="up">Uplink (Device -> Network Server)</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="text-secondary mb-2">2. Command</label>
                                    <select class="form-select" id="macGenCmd" onchange="updateMacParams()"></select>
                                </div>
                                <div id="macGenParamArea" class="mb-4"></div>
                                <button class="btn btn-primary w-100 mt-2" onclick="runMacGenerator()">Generate
                                    Hex</button>
                            </div>

                            <!-- Decoder Inputs -->
                            <div id="mac-dec-view" style="display: none;">
                                <div class="mb-3">
                                    <label class="text-secondary mb-2">Direction Context</label>
                                    <select class="form-select" id="macDecDir">
                                        <option value="down">Downlink (Parse Requests/Answers from Server)</option>
                                        <option value="up">Uplink (Parse Requests/Answers from Device)</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="text-secondary mb-2">MAC Payload Hex</label>
                                    <textarea class="form-control font-monospace" id="macDecInput" rows="5"
                                        placeholder="Paste MAC Hex here (e.g. 0360...)"></textarea>
                                </div>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-success flex-grow-1"
                                        onclick="runMacDecoder()">Decode</button>
                                    <button class="btn btn-outline-secondary" onclick="pasteText('macDecInput')"
                                        title="Paste from Clipboard"><i class="fa-regular fa-paste"></i></button>
                                    <button class="btn btn-outline-secondary" onclick="clearMacDecoder()">Clear</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-7">
                    <div class="custom-card h-100">
                        <div class="card-header">
                            Output Result
                        </div>
                        <div class="card-body p-0">
                            <!-- Generator Output -->
                            <div id="mac-gen-output-area" class="p-4">
                                <label class="text-secondary mb-2">Generated Hex String</label>
                                <div class="d-flex gap-2 mb-3">
                                    <div class="gen-output flex-grow-1 mb-0" id="macGenOutput">Select commands and click
                                        Generate</div>
                                    <button class="btn btn-outline-secondary" onclick="copyText('macGenOutput')"
                                        title="Copy to Clipboard">
                                        <i class="fa-regular fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                            <!-- Decoder Output -->
                            <div id="mac-dec-output-area" style="display: none;" class="h-100">
                                <div id="macDecResult" class="text-light h-100 p-3">
                                    <pre
                                        class="h-100 border-0 rounded-0 m-0 p-3 text-light font-monospace">Enter Hex string and click Decode...</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Scripts -->
    <script src="js/parser.js"></script>
    <script src="js/generator.js"></script>
    <script src="js/decoder.js"></script>
    <script src="js/mac_cmd.js"></script>
    <script src="js/main.js"></script>

</body>

</html>